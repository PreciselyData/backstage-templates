apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: node-service-kit
  title: Node Service Kit
  description: Creates a new project using the node-service-kit, for Node 18+ projects with multiple Fastify feature sets preconfigured.
spec:
  owner: backstage/techdocs-core
  type: service

  parameters:
    - title: Create a new repository
      required:
        - name
      properties:
        name:
          title: Repository Name
          type: string
          description: Unique name for the repository
          ui:autofocus: true
        group:
          title: Repository Group
          type: string
          description: Group under which this repository will belong (you must have permissions)
          default: devops
          enum:
            - assure
            - automate-saas-platform
            - cloud
            - customer-onboarding
            - data
            - data-integration
            - data-quality
            - datahub
            - devops
            - di-suite-catalog
            - DI-Suite-SaaS-Platform
            - engageone
            - engineering
            - govern
            - ibm-infrastructure
            - location-intelligence
            - precisely-labs
            - professional-services
            - project-templates
            - ui-ux-globalization
          enumNames:
            - Assure
            - Automate SaaS Platform
            - Cloud
            - Customer Onboarding
            - Data
            - Data Integration
            - Data Quality
            - Datahub
            - DevOps
            - DI Suite Catalog
            - DI Suite SaaS Platform
            - EngageOne
            - Engineering
            - Govern
            - IBM Infrastructure Research and Development
            - Location Intelligence
            - Precisely Labs
            - Professional Services
            - Project Templates
            - UI UX Globalization
    - title: Select Fastify features
      required:
        - features
      properties:
        features:
          title: Select features
          type: array
          items:
            type: string
            enum:
              - authentication
              - bullmq
              - cache
              - graphQL
              - health
              - instrumentation
              - jsonApi
              - kafka
              - launchDarkly
              - mongo
              - swagger
              - validator
            enumNames:
              - JWT Authentication
              - BullMQ
              - Memory Cache
              - GraphQL (Graph Query Language)
              - System Health Check
              - OpenTelemetry Instrumentation
              - JSON API Stack
              - Kafka
              - LaunchDarkly
              - MongoDB
              - Swagger/REST API Services
              - Input and JSON Body Validation

  steps:
    - id: fetch-base
      name: Fetch Base
      action: fetch:template
      input:
        url: ./template
        values:
          name: ${{ parameters.name }}
          group: ${{ parameters.group }}

  output:
    links:
      - title: Repository
        url: ${{ steps['publish'].output.remoteUrl }}
      - title: Open in catalog
        icon: catalog
        entityRef: ${{ steps['register'].output.entityRef }}
